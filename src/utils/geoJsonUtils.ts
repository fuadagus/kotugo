// Extended sample data extracted from the GeoJSON file for comprehensive demonstration
const sampleJalanData = {
  "type": "FeatureCollection",
  "name": "Jalan",
  "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
  "features": [
    {
      "type": "Feature",
      "properties": { "NAMRJL": null, "KONRJL": 0, "MATRJL": 0, "FGSRJL": 0, "UTKRJL": 0, "TOLRJL": 0, "WLYRJL": 0, "AUTRJL": 0, "KLSRJL": 0, "SPCRJL": 0, "JPARJL": 0, "ARHRJL": 0, "STARJL": 0, "KLLRJL": null, "MEDRJL": 0, "LOCRJL": 0, "JARRJL": 0, "FCODE": null, "REMARK": "Jalan Lokal", "SRS_ID": null, "LCODE": "CA0080", "METADATA": null, "SHAPE_Leng": 0.00085019591 },
      "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 110.425575040000098, -7.759816563999909, 149.702999999994063 ], [ 110.42640575100009, -7.759997539999961, 149.475000000005821 ] ] ] }
    },
    {
      "type": "Feature",
      "properties": { "NAMRJL": null, "KONRJL": 0, "MATRJL": 0, "FGSRJL": 0, "UTKRJL": 0, "TOLRJL": 0, "WLYRJL": 0, "AUTRJL": 0, "KLSRJL": 0, "SPCRJL": 0, "JPARJL": 0, "ARHRJL": 0, "STARJL": 0, "KLLRJL": null, "MEDRJL": 0, "LOCRJL": 0, "JARRJL": 0, "FCODE": null, "REMARK": "Jalan Lain", "SRS_ID": null, "LCODE": "CA0080", "METADATA": null, "SHAPE_Leng": 0.0014644551 },
      "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 110.471510636000048, -7.744175123999984, 164.559999999997672 ], [ 110.471498813000039, -7.744187754999963, 165.059999999997672 ], [ 110.470086669000082, -7.744100459999935, 164.520000000004075 ], [ 110.470054553000097, -7.744096883999905, 164.460000000006403 ] ] ] }
    },
    {
      "type": "Feature",
      "properties": { "NAMRJL": null, "KONRJL": 0, "MATRJL": 0, "FGSRJL": 0, "UTKRJL": 0, "TOLRJL": 0, "WLYRJL": 0, "AUTRJL": 0, "KLSRJL": 0, "SPCRJL": 0, "JPARJL": 0, "ARHRJL": 0, "STARJL": 0, "KLLRJL": null, "MEDRJL": 0, "LOCRJL": 0, "JARRJL": 0, "FCODE": null, "REMARK": "Jalan Lokal", "SRS_ID": null, "LCODE": "CA0080", "METADATA": null, "SHAPE_Leng": 0.00489735684 },
      "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 110.388635742000034, -7.629286361999952, 536.149999999994179 ], [ 110.388583394000051, -7.629388697999982, 535.860000000000582 ], [ 110.388140216000068, -7.63027348, 530.619999999995343 ], [ 110.388060639000059, -7.630429939999981, 528.910000000003492 ] ] ] }
    },
    {
      "type": "Feature",
      "properties": { "NAMRJL": null, "KONRJL": 0, "MATRJL": 0, "FGSRJL": 0, "UTKRJL": 0, "TOLRJL": 0, "WLYRJL": 0, "AUTRJL": 0, "KLSRJL": 0, "SPCRJL": 0, "JPARJL": 0, "ARHRJL": 0, "STARJL": 0, "KLLRJL": null, "MEDRJL": 0, "LOCRJL": 0, "JARRJL": 0, "FCODE": null, "REMARK": "Jalan Setapak", "SRS_ID": null, "LCODE": "CA0080", "METADATA": null, "SHAPE_Leng": 0.00069256309 },
      "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 110.471932422000037, -7.812872471999952, 95.559999999997672 ], [ 110.471950698000043, -7.812395609999932, 94.490000000005239 ], [ 110.471982990000043, -7.812270726999902, 94.460000000006403 ] ] ] }
    },
    {
      "type": "Feature", 
      "properties": { "NAMRJL": null, "KONRJL": 0, "MATRJL": 0, "FGSRJL": 0, "UTKRJL": 0, "TOLRJL": 0, "WLYRJL": 0, "AUTRJL": 0, "KLSRJL": 0, "SPCRJL": 0, "JPARJL": 0, "ARHRJL": 0, "STARJL": 0, "KLLRJL": null, "MEDRJL": 0, "LOCRJL": 0, "JARRJL": 0, "FCODE": null, "REMARK": "Jalan Lokal", "SRS_ID": null, "LCODE": "CA0080", "METADATA": null, "SHAPE_Leng": 0.00342918455 },
      "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 110.343411060000022, -7.71270550499996, 208.589999999996508 ], [ 110.343240157000096, -7.712808383999946, 207.380000000004657 ], [ 110.342314867000098, -7.713312049999963, 204.919999999998254 ], [ 110.341897052000078, -7.713519905999931, 204.369999999995343 ] ] ] }
    },
    {
      "type": "Feature",
      "properties": { "NAMRJL": null, "KONRJL": 0, "MATRJL": 0, "FGSRJL": 0, "UTKRJL": 0, "TOLRJL": 0, "WLYRJL": 0, "AUTRJL": 0, "KLSRJL": 0, "SPCRJL": 0, "JPARJL": 0, "ARHRJL": 0, "STARJL": 0, "KLLRJL": null, "MEDRJL": 0, "LOCRJL": 0, "JARRJL": 0, "FCODE": null, "REMARK": "Jalan Lain", "SRS_ID": null, "LCODE": "CA0080", "METADATA": null, "SHAPE_Leng": 0.00243028557 },
      "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 110.423561203000091, -7.67066375199996, 394.399999999994179 ], [ 110.42307043100007, -7.670662560999951, 393.612399999998161 ], [ 110.422709612000062, -7.670670642999909, 393.264100000000326 ], [ 110.42266317900004, -7.670671684, 393.08520000000135 ] ] ] }
    },
    {
      "type": "Feature",
      "properties": { "NAMRJL": null, "KONRJL": 0, "MATRJL": 0, "FGSRJL": 0, "UTKRJL": 0, "TOLRJL": 0, "WLYRJL": 0, "AUTRJL": 0, "KLSRJL": 0, "SPCRJL": 0, "JPARJL": 0, "ARHRJL": 0, "STARJL": 0, "KLLRJL": null, "MEDRJL": 0, "LOCRJL": 0, "JARRJL": 0, "FCODE": null, "REMARK": "Jalan Lokal", "SRS_ID": null, "LCODE": "CA0080", "METADATA": null, "SHAPE_Leng": 0.00314433732 },
      "geometry": { "type": "MultiLineString", "coordinates": [ [ [ 110.374387027000054, -7.767273521999883, 135.75 ], [ 110.374745124000114, -7.766695168999902, 134.490000000005239 ], [ 110.374772923000108, -7.7666500569999, 134.520000000004075 ], [ 110.374868934000048, -7.766516003999911, 134.940000000002328 ] ] ] }
    }
  ]
};

export interface RoadFeature {
  type: 'Feature';
  properties: {
    NAMRJL: string | null;
    KONRJL: number;
    MATRJL: number;
    FGSRJL: number;
    UTKRJL: number;
    TOLRJL: number;
    WLYRJL: number;
    AUTRJL: number;
    KLSRJL: number;
    SPCRJL: number;
    JPARJL: number;
    ARHRJL: number;
    STARJL: number;
    KLLRJL: string | null;
    MEDRJL: number;
    LOCRJL: number;
    JARRJL: number;
    FCODE: string | null;
    REMARK: string;
    SRS_ID: string | null;
    LCODE: string;
    METADATA: string | null;
    SHAPE_Leng: number;
  };
  geometry: {
    type: 'MultiLineString';
    coordinates: number[][][];
  };
}

export interface GeoJSONData {
  type: 'FeatureCollection';
  name: string;
  crs: {
    type: string;
    properties: {
      name: string;
    };
  };
  features: RoadFeature[];
}

// Type guard to ensure we have the correct data structure
export const isValidGeoJSON = (data: any): data is GeoJSONData => {
  return data && 
         data.type === 'FeatureCollection' && 
         Array.isArray(data.features) &&
         data.features.length > 0;
};

// Get all road coordinates from GeoJSON
export const getAllRoadCoordinates = (): number[][][] => {
  if (!isValidGeoJSON(sampleJalanData)) {
    console.warn('Invalid GeoJSON data structure');
    return [];
  }

  const allCoordinates: number[][][] = [];
  
  sampleJalanData.features.forEach((feature: RoadFeature) => {
    if (feature.geometry.type === 'MultiLineString') {
      feature.geometry.coordinates.forEach((lineString: number[][]) => {
        // Convert from [lng, lat, elevation] to [lat, lng] format for Leaflet
        const convertedCoords = lineString.map((coord: number[]) => [coord[1], coord[0]]);
        allCoordinates.push(convertedCoords);
      });
    }
  });

  return allCoordinates;
};

// Get roads by type/classification
export const getRoadsByType = (type: string): number[][][] => {
  if (!isValidGeoJSON(sampleJalanData)) {
    return [];
  }

  const roadsByType: number[][][] = [];
  
  sampleJalanData.features
    .filter((feature: RoadFeature) => feature.properties.REMARK === type)
    .forEach((feature: RoadFeature) => {
      if (feature.geometry.type === 'MultiLineString') {
        feature.geometry.coordinates.forEach((lineString: number[][]) => {
          const convertedCoords = lineString.map((coord: number[]) => [coord[1], coord[0]]);
          roadsByType.push(convertedCoords);
        });
      }
    });

  return roadsByType;
};

// Get road types available in the dataset
export const getAvailableRoadTypes = (): string[] => {
  if (!isValidGeoJSON(sampleJalanData)) {
    return [];
  }

  const types = new Set<string>();
  sampleJalanData.features.forEach((feature: RoadFeature) => {
    if (feature.properties.REMARK) {
      types.add(feature.properties.REMARK);
    }
  });

  return Array.from(types);
};

// Create angkot routes using actual road segments
export const createAngkotRoutesFromGeoJSON = () => {
  const roadTypes = getAvailableRoadTypes();
  console.log('Available road types:', roadTypes);

  // Get different types of roads for different angkot routes
  const jalanLokal = getRoadsByType('Jalan Lokal');
  const jalanLain = getRoadsByType('Jalan Lain');

  // Create routes using combinations of road segments
  const routes = {
    route1: jalanLokal.length > 0 ? jalanLokal[0] : [], // First local road
    route2: jalanLain.length > 0 ? jalanLain[0] : [],  // First other road
    route3: jalanLokal.length > 1 ? jalanLokal[1] : [], // Second local road
    route4: jalanLain.length > 1 ? jalanLain[1] : [],  // Second other road
    route5: jalanLokal.length > 0 ? jalanLokal[0].slice(0, Math.floor(jalanLokal[0].length / 2)) : [] // Partial route
  };

  return routes;
};

// Calculate route statistics
export const getRouteStatistics = () => {
  if (!isValidGeoJSON(sampleJalanData)) {
    return {
      totalFeatures: 0,
      roadTypes: [],
      totalLength: 0
    };
  }

  const roadTypes = getAvailableRoadTypes();
  const totalFeatures = sampleJalanData.features.length;
  const totalLength = sampleJalanData.features.reduce((sum: number, feature: RoadFeature) => {
    return sum + (feature.properties.SHAPE_Leng || 0);
  }, 0);

  return {
    totalFeatures,
    roadTypes,
    totalLength
  };
};

export default sampleJalanData;
